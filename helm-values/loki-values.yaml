---
# --- Helm Chart Settings (Chart deployment logic) ---

# Deploys Loki as a single process instead of a microservices cluster.
deploymentMode: SingleBinary

# Disables the NGINX gateway (not needed for 'SingleBinary' mode).
gateway:
  enabled: false

# Configures the 'SingleBinary' deployment pod.
singleBinary:
  # Runs a single pod instance.
  replicas: 1
  # Disables PersistentVolumeClaims for ephemeral, local-only storage.
  persistence:
    enabled: false

  # Runs the pod as a specific non-root user (10001) and group (10001).
  podSecurityContext:
    fsGroup: 10001
    runAsUser: 10001
    runAsGroup: 10001

  # Defines temporary 'emptyDir' volumes.
  extraVolumes:
    - name: data
      emptyDir: {}
    - name: varloki
      emptyDir: {}

  # Mounts the writable volumes to fix "read-only file system" errors in 'kind'.
  extraVolumeMounts:
    - name: data
      mountPath: /data
    - name: varloki
      mountPath: /var/loki

# Disables other deployment modes (read/write/backend) to validate 'SingleBinary' mode.
write:
  replicas: 0
read:
  replicas: 0
backend:
  replicas: 0

# --- Loki Application Config (Passed into the Loki process) ---
loki:
  # Overrides the default HA replication (3) to 1 for a single node.
  commonConfig:
    replication_factor: 1

  # Uses an in-memory ring for service discovery (required for single node).
  distributor:
    ring:
      kvstore:
        store: inmemory

  # Uses a simple, built-in index schema for local testing.
  useTestSchema: true

  # Disables multi-tenancy and authentication for simple access.
  auth_enabled: false

  # Configures Loki to store log chunks on the local filesystem.
  storage:
    type: filesystem
    filesystem:
      chunks_directory: /data/loki/chunks

  # Configures the "ruler" (for alerts) to also use the local filesystem.
  rulerConfig:
    storage:
      type: local
      local:
        directory: /var/loki/rules-ruler

# --- Disable Optional Caching ---
# Disables optional caches to reduce memory usage in the 'kind' cluster.
chunksCache:
  enabled: false
resultsCache:
  enabled: false
