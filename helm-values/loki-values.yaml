---
# --- Helm Chart Settings (Chart deployment logic) ---

# Deploys Loki as a single "monolithic" process instead of a microservices cluster.
deploymentMode: SingleBinary

# Configures the 'SingleBinary' deployment pod.
singleBinary:
  # Runs a single pod instance.
  replicas: 1
  persistence:
    # Disables PersistentVolumeClaims (PVCs) for ephemeral, local-only storage.
    enabled: false

  # --- Pod Security Context (Production Best Practice) ---
  # Runs the pod as a specific non-root user (10001) and group (10001).
  # 'fsGroup' ensures that mounted volumes are owned by this group,
  # making them writable by the Loki process.
  podSecurityContext:
    fsGroup: 10001
    runAsUser: 10001
    runAsGroup: 10001

  # --- LOCAL CLUSTER FIX (Workaround for 'kind') ---
  # HACK: Manually defines temporary 'emptyDir' volumes.
  # WHY: The chart in this mode assumes a writable /data path exists,
  # but does not create one. This is a workaround to fix the
  # "mkdir: read-only file system" error in local clusters like 'kind'.
  # This is not a standard production configuration.
  extraVolumes:
    - name: data
      emptyDir: {}
    - name: varloki
      emptyDir: {}

  # Mounts the 'emptyDir' volumes to the paths Loki expects.
  extraVolumeMounts:
    - name: data
      mountPath: /data
    - name: varloki
      mountPath: /var/loki

# Explicitly disable scalable components (read/write/backend)
# to pass the chart's validation when in SingleBinary mode.
write:
  replicas: 0
read:
  replicas: 0
backend:
  replicas: 0

# --- Loki Application Config (Passed into the Loki process) ---
loki:
  # Uses a simple, built-in index schema for local testing.
  useTestSchema: true

  # Disables multi-tenancy and authentication for simplified local access.
  auth_enabled: false

  # Configures Loki to store all data on the pod's local filesystem.
  storage:
    type: filesystem
    filesystem:
      # Configures Loki to use paths within the writable /data volume.
      chunks_directory: /data/loki/chunks
      rules_directory: /data/loki/rules

  # Configures the "ruler" component (for alerting/recording rules).
  rulerConfig:
    storage:
      # Tells the ruler to also use the local filesystem.
      type: local
      local:
        # Configures the ruler to use the writable /var/loki volume.
        directory: /var/loki/rules-ruler

# --- Disable Optional Caching ---
chunksCache:
  enabled: false
resultsCache:
  enabled: false
